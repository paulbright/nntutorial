<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Network Forward & Backward Propagation Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .controls { margin: 20px 0; text-align: center; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        
        .network-container { position: relative; width: 800px; height: 400px; margin: 30px auto; }
        .neuron { position: absolute; width: 60px; height: 60px; border-radius: 50%; background: #e9ecef; 
                 border: 3px solid #6c757d; display: flex; align-items: center; justify-content: center; 
                 font-weight: bold; font-size: 14px; }
        .neuron.active { background: #28a745; color: white; border-color: #1e7e34; }
        
        .weight-label { position: absolute; font-size: 12px; color: #495057; font-weight: bold; 
                       background: rgba(255,255,255,0.8); padding: 2px 4px; border-radius: 3px; }
        .bias-label { position: absolute; font-size: 12px; color: #007bff; font-weight: bold; }
        
        .info-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .info-box { background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff; }
        .weights-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .weights-table th, .weights-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .weights-table th { background: #f8f9fa; }
        .step-info { font-size: 18px; font-weight: bold; color: #495057; margin: 10px 0; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Neural Network Tutorial: Forward & Backward Propagation</h1>
        <p><i>(*Implementation of the neural network forward and backward propagation tutorials of Bevan Smith https://www.youtube.com/@bevansmithdatascience9580*)</i></p>
        <div class="controls">
            <button class="btn-primary" onclick="startDemo()">Start Demo</button>
            <button class="btn-success" onclick="nextStep()">Next Step</button>
            <button class="btn-warning" onclick="reset()">Reset</button>
        </div>

        <div class="step-info" id="stepInfo">Click 'Start Demo' to begin</div>

        <div class="network-container">
            <!-- Input Layer -->
            <div class="neuron" id="x1" style="left: 50px; top: 50px;">x1</div>
            <div class="neuron" id="x2" style="left: 50px; top: 150px;">x2</div>
            <div class="neuron" id="x3" style="left: 50px; top: 250px;">x3</div>
            
            <!-- Hidden Layer -->
            <div class="neuron" id="h1" style="left: 350px; top: 100px;">H1</div>
            <div class="neuron" id="h2" style="left: 350px; top: 200px;">H2</div>
            <div class="bias-label" id="b1Label" style="left: 420px; top: 115px;">b1: -15.00</div>
            <div class="bias-label" id="b2Label" style="left: 420px; top: 215px;">b2: -15.00</div>
            
            <!-- Output Layer -->
            <div class="neuron" id="output" style="left: 650px; top: 150px;">Σ</div>
            <div class="bias-label" id="b3Label" style="left: 720px; top: 165px;">b3: 20.00</div>
            
            <!-- SVG for arrows -->
            <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                <!-- Input to Hidden connections -->
                <line x1="110" y1="80" x2="350" y2="130" stroke="#6c757d" stroke-width="2"/>
                <polygon points="350,125 360,130 350,135" fill="#6c757d"/>
                
                <line x1="110" y1="80" x2="350" y2="230" stroke="#6c757d" stroke-width="2"/>
                <polygon points="345,225 355,230 345,235" fill="#6c757d"/>
                
                <line x1="110" y1="180" x2="350" y2="130" stroke="#6c757d" stroke-width="2"/>
                <polygon points="350,125 360,130 350,135" fill="#6c757d"/>
                
                <line x1="110" y1="180" x2="350" y2="230" stroke="#6c757d" stroke-width="2"/>
                <polygon points="345,225 355,230 345,235" fill="#6c757d"/>
                
                <line x1="110" y1="280" x2="350" y2="130" stroke="#6c757d" stroke-width="2"/>
                <polygon points="350,125 360,130 350,135" fill="#6c757d"/>
                
                <line x1="110" y1="280" x2="350" y2="230" stroke="#6c757d" stroke-width="2"/>
                <polygon points="345,225 355,230 345,235" fill="#6c757d"/>
                
                <!-- Hidden to Output connections -->
                <line x1="410" y1="130" x2="650" y2="180" stroke="#6c757d" stroke-width="2"/>
                <polygon points="645,175 655,180 645,185" fill="#6c757d"/>
                
                <line x1="410" y1="230" x2="650" y2="180" stroke="#6c757d" stroke-width="2"/>
                <polygon points="645,185 655,180 645,175" fill="#6c757d"/>
            </svg>
            
            <!-- Weight labels -->
            <div class="weight-label" id="w1Label" style="left: 200px; top: 95px;">w1: 0.10</div>
            <div class="weight-label" id="w2Label" style="left: 200px; top: 140px;">w2: 0.15</div>
            <div class="weight-label" id="w3Label" style="left: 200px; top: 145px;">w3: 0.10</div>
            <div class="weight-label" id="w4Label" style="left: 200px; top: 190px;">w4: 0.05</div>
            <div class="weight-label" id="w5Label" style="left: 200px; top: 195px;">w5: 0.10</div>
            <div class="weight-label" id="w6Label" style="left: 200px; top: 240px;">w6: -0.20</div>
            <div class="weight-label" id="w7Label" style="left: 520px; top: 145px;">w7: 12.00</div>
            <div class="weight-label" id="w8Label" style="left: 520px; top: 195px;">w8: 9.00</div>
        </div>

        <div class="info-panel">
            <div class="info-box" id="currentCalc">
                <h4>Current Calculation</h4>
                <div id="calcDetails">Ready to start...</div>
            </div>
            <div class="info-box" id="currentValues">
                <h4>Current Values</h4>
                <div id="valueDetails">Waiting for input...</div>
            </div>
        </div>

        <div class="info-box">
            <h4>Weights and Biases Progress</h4>
            <table class="weights-table" id="weightsTable">
                <thead>
                    <tr>
                        <th>Step</th><th>w1</th><th>w2</th><th>w3</th><th>w4</th><th>w5</th><th>w6</th><th>w7</th><th>w8</th><th>b1</th><th>b2</th><th>b3</th><th>Loss</th>
                    </tr>
                </thead>
                <tbody id="weightsBody">
                    <tr><td>Initial</td><td>0.1</td><td>0.15</td><td>0.1</td><td>0.05</td><td>0.1</td><td>-0.2</td><td>12</td><td>9</td><td>-15</td><td>-15</td><td>20</td><td>-</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let w1=0.1, w2=0.15, w3=0.1, w4=0.05, w5=0.1, w6=-0.2, w7=12, w8=9;
        let b1=-15, b2=-15, b3=20;
        const lr = 0.01;
        
        const data = [
            [60, 80, 5, 81],
            [70, 75, 7, 94],
            [50, 55, 10, 45],
            [40, 56, 7, 43]
        ];
        
        let currentEpoch = 0;
        let currentSample = 0;
        let currentStep = 0;
        let isRunning = false;
        
        const steps = [
            'forward_z1', 'forward_z2', 'forward_g1', 'forward_g2', 'forward_yp', 'forward_loss',
            'backward_output', 'backward_hidden', 'backward_weights', 'update_weights'
        ];
        
        function sigmoid(x) {
            return 1 / (1 + Math.exp(-x));
        }
        
        function sigmoidDerivative(x) {
            return x * (1 - x);
        }
        
        function updateWeightLabels() {
            document.getElementById('w1Label').textContent = `w1: ${w1.toFixed(2)}`;
            document.getElementById('w2Label').textContent = `w2: ${w2.toFixed(2)}`;
            document.getElementById('w3Label').textContent = `w3: ${w3.toFixed(2)}`;
            document.getElementById('w4Label').textContent = `w4: ${w4.toFixed(2)}`;
            document.getElementById('w5Label').textContent = `w5: ${w5.toFixed(2)}`;
            document.getElementById('w6Label').textContent = `w6: ${w6.toFixed(2)}`;
            document.getElementById('w7Label').textContent = `w7: ${w7.toFixed(2)}`;
            document.getElementById('w8Label').textContent = `w8: ${w8.toFixed(2)}`;
            document.getElementById('b1Label').textContent = `b1: ${b1.toFixed(2)}`;
            document.getElementById('b2Label').textContent = `b2: ${b2.toFixed(2)}`;
            document.getElementById('b3Label').textContent = `b3: ${b3.toFixed(2)}`;
        }
        
        function startDemo() {
            isRunning = true;
            currentEpoch = 0;
            currentSample = 0;
            currentStep = 0;
            updateWeightLabels();
            updateDisplay();
        }
        
        function nextStep() {
            if (!isRunning) return;
            
            const [x1, x2, x3, target] = data[currentSample];
            
            switch(steps[currentStep]) {
                case 'forward_z1':
                    const z1 = w1*x1 + w3*x2 + w5*x3 + b1;
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing z1`;
                    document.getElementById('calcDetails').innerHTML = `z1 = w1*x1 + w3*x2 + w5*x3 + b1<br>z1 = ${w1.toFixed(4)}*${x1} + ${w3.toFixed(4)}*${x2} + ${w5.toFixed(4)}*${x3} + ${b1.toFixed(4)} = ${z1.toFixed(4)}`;
                    document.getElementById('valueDetails').innerHTML = `Sample ${currentSample+1}: x1=${x1}, x2=${x2}, x3=${x3}<br>Target: ${target}`;
                    highlightNeurons(['x1', 'x2', 'x3', 'h1']);
                    break;
                    
                case 'forward_z2':
                    const z2 = w2*x1 + w4*x2 + w6*x3 + b2;
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing z2`;
                    document.getElementById('calcDetails').innerHTML = `z2 = w2*x1 + w4*x2 + w6*x3 + b2<br>z2 = ${w2.toFixed(4)}*${x1} + ${w4.toFixed(4)}*${x2} + ${w6.toFixed(4)}*${x3} + ${b2.toFixed(4)} = ${z2.toFixed(4)}`;
                    highlightNeurons(['x1', 'x2', 'x3', 'h2']);
                    break;
                    
                case 'forward_g1':
                    const z1_calc = w1*x1 + w3*x2 + w5*x3 + b1;
                    const g1 = sigmoid(z1_calc);
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing g1 (sigmoid)`;
                    document.getElementById('calcDetails').innerHTML = `g1 = sigmoid(z1) = sigmoid(${z1_calc.toFixed(4)}) = ${g1.toFixed(4)}`;
                    highlightNeurons(['h1']);
                    break;
                    
                case 'forward_g2':
                    const z2_calc = w2*x1 + w4*x2 + w6*x3 + b2;
                    const g2 = sigmoid(z2_calc);
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing g2 (sigmoid)`;
                    document.getElementById('calcDetails').innerHTML = `g2 = sigmoid(z2) = sigmoid(${z2_calc.toFixed(4)}) = ${g2.toFixed(4)}`;
                    highlightNeurons(['h2']);
                    break;
                    
                case 'forward_yp':
                    const z1_f = w1*x1 + w3*x2 + w5*x3 + b1;
                    const z2_f = w2*x1 + w4*x2 + w6*x3 + b2;
                    const g1_f = sigmoid(z1_f);
                    const g2_f = sigmoid(z2_f);
                    const yp = w7*g1_f + w8*g2_f + b3;
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing output yp`;
                    document.getElementById('calcDetails').innerHTML = `yp = w7*g1 + w8*g2 + b3<br>yp = ${w7.toFixed(4)}*${g1_f.toFixed(4)} + ${w8.toFixed(4)}*${g2_f.toFixed(4)} + ${b3.toFixed(4)} = ${yp.toFixed(4)}`;
                    highlightNeurons(['h1', 'h2', 'output']);
                    break;
                    
                case 'forward_loss':
                    const z1_l = w1*x1 + w3*x2 + w5*x3 + b1;
                    const z2_l = w2*x1 + w4*x2 + w6*x3 + b2;
                    const g1_l = sigmoid(z1_l);
                    const g2_l = sigmoid(z2_l);
                    const yp_l = w7*g1_l + w8*g2_l + b3;
                    const loss = (target - yp_l) ** 2;
                    document.getElementById('stepInfo').textContent = `Forward Pass - Computing loss`;
                    document.getElementById('calcDetails').innerHTML = `Loss = (target - yp)²<br>Loss = (${target} - ${yp_l.toFixed(4)})² = ${loss.toFixed(4)}`;
                    highlightNeurons(['output']);
                    break;
                    
                case 'backward_output':
                    document.getElementById('stepInfo').textContent = `Backward Pass - Output layer gradients`;
                    document.getElementById('calcDetails').innerHTML = `Computing gradients for output layer weights w7, w8 and bias b3`;
                    highlightNeurons(['output']);
                    break;
                    
                case 'backward_hidden':
                    document.getElementById('stepInfo').textContent = `Backward Pass - Hidden layer gradients`;
                    document.getElementById('calcDetails').innerHTML = `Computing gradients for hidden layer weights and biases`;
                    highlightNeurons(['h1', 'h2']);
                    break;
                    
                case 'backward_weights':
                    document.getElementById('stepInfo').textContent = `Backward Pass - Input layer gradients`;
                    document.getElementById('calcDetails').innerHTML = `Computing gradients for input-to-hidden weights w1-w6`;
                    highlightNeurons(['x1', 'x2', 'x3', 'h1', 'h2']);
                    break;
                    
                case 'update_weights':
                    const z1_u = w1*x1 + w3*x2 + w5*x3 + b1;
                    const z2_u = w2*x1 + w4*x2 + w6*x3 + b2;
                    const g1_u = sigmoid(z1_u);
                    const g2_u = sigmoid(z2_u);
                    const yp_u = w7*g1_u + w8*g2_u + b3;
                    const loss_u = (target - yp_u) ** 2;
                    
                    const dL_dyp = -2 * (target - yp_u);
                    const dL_dw7 = dL_dyp * g1_u;
                    const dL_dw8 = dL_dyp * g2_u;
                    const dL_db3 = dL_dyp;
                    
                    const dL_dg1 = dL_dyp * w7;
                    const dL_dg2 = dL_dyp * w8;
                    const dL_dz1 = dL_dg1 * sigmoidDerivative(g1_u);
                    const dL_dz2 = dL_dg2 * sigmoidDerivative(g2_u);
                    
                    const dL_dw1 = dL_dz1 * x1;
                    const dL_dw2 = dL_dz2 * x1;
                    const dL_dw3 = dL_dz1 * x2;
                    const dL_dw4 = dL_dz2 * x2;
                    const dL_dw5 = dL_dz1 * x3;
                    const dL_dw6 = dL_dz2 * x3;
                    const dL_db1 = dL_dz1;
                    const dL_db2 = dL_dz2;
                    
                    w1 -= lr * dL_dw1;
                    w2 -= lr * dL_dw2;
                    w3 -= lr * dL_dw3;
                    w4 -= lr * dL_dw4;
                    w5 -= lr * dL_dw5;
                    w6 -= lr * dL_dw6;
                    w7 -= lr * dL_dw7;
                    w8 -= lr * dL_dw8;
                    b1 -= lr * dL_db1;
                    b2 -= lr * dL_db2;
                    b3 -= lr * dL_db3;
                    
                    document.getElementById('stepInfo').textContent = `Weights Updated - Sample ${currentSample+1} Complete`;
                    document.getElementById('calcDetails').innerHTML = `All weights and biases updated using gradient descent<br>Learning rate: ${lr}`;
                    
                    const tbody = document.getElementById('weightsBody');
                    const row = tbody.insertRow();
                    row.innerHTML = `<td>E${currentEpoch+1}S${currentSample+1}</td><td>${w1.toFixed(4)}</td><td>${w2.toFixed(4)}</td><td>${w3.toFixed(4)}</td><td>${w4.toFixed(4)}</td><td>${w5.toFixed(4)}</td><td>${w6.toFixed(4)}</td><td>${w7.toFixed(4)}</td><td>${w8.toFixed(4)}</td><td>${b1.toFixed(4)}</td><td>${b2.toFixed(4)}</td><td>${b3.toFixed(4)}</td><td>${loss_u.toFixed(4)}</td>`;
                    
                    updateWeightLabels();
                    highlightNeurons([]);
                    
                    currentSample++;
                    if (currentSample >= data.length) {
                        currentSample = 0;
                        currentEpoch++;
                        if (currentEpoch >= 3) {
                            document.getElementById('stepInfo').textContent = `Training Complete! 3 epochs finished.`;
                            isRunning = false;
                            return;
                        }
                    }
                    currentStep = -1;
                    break;
            }
            
            currentStep = (currentStep + 1) % steps.length;
        }
        
        function highlightNeurons(neuronIds) {
            document.querySelectorAll('.neuron').forEach(n => n.classList.remove('active'));
            neuronIds.forEach(id => {
                const neuron = document.getElementById(id);
                if (neuron) neuron.classList.add('active');
            });
        }
        
        function reset() {
            w1=0.1; w2=0.15; w3=0.1; w4=0.05; w5=0.1; w6=-0.2; w7=12; w8=9;
            b1=-15; b2=-15; b3=20;
            currentEpoch = 0;
            currentSample = 0;
            currentStep = 0;
            isRunning = false;
            
            document.getElementById('stepInfo').textContent = "Click 'Start Demo' to begin";
            document.getElementById('calcDetails').innerHTML = "Ready to start...";
            document.getElementById('valueDetails').innerHTML = "Waiting for input...";
            
            const tbody = document.getElementById('weightsBody');
            tbody.innerHTML = '<tr><td>Initial</td><td>0.1</td><td>0.15</td><td>0.1</td><td>0.05</td><td>0.1</td><td>-0.2</td><td>12</td><td>9</td><td>-15</td><td>-15</td><td>20</td><td>-</td></tr>';
            
            updateWeightLabels();
            highlightNeurons([]);
        }
        
        function updateDisplay() {
            if (!isRunning) return;
            const [x1, x2, x3, target] = data[currentSample];
            document.getElementById('valueDetails').innerHTML = `Epoch ${currentEpoch+1}, Sample ${currentSample+1}<br>x1=${x1}, x2=${x2}, x3=${x3}, target=${target}`;
        }
    </script>
</body>
</html>
